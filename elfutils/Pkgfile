# Description: Utilities to handle ELF object files
# URL:         https://sourceware.org/elfutils
# Depends on:  bzip2 zstd

name=elfutils
version=0.192
release=2
source="https://sourceware.org/$name/ftp/$version/$name-$version.tar.bz2
	elfutils-0.192-libelf-static.patch"

build() {
	# https://sourceware.org/bugzilla/show_bug.cgi?id=32293
	patch -d $name-$version -Np1 -i $SRC/elfutils-0.192-libelf-static.patch

	# fat-lto-objects is required for non-mangled .a files in libelf
	CFLAGS="$CFLAGS -ffat-lto-objects"

	mkdir build; cd build

	autoreconf -fi ../$name-$version
	../$name-$version/configure      \
		--prefix=/usr            \
		--program-prefix=eu-     \
		--disable-debuginfod     \
		--disable-libdebuginfod  \
		--disable-nls            \

	make V=1
	make DESTDIR=$PKG install

	# remove disabled debuginfod* manual pages
	rm -r $PKG/usr/share/man/man*/debuginfod*.?
	rmdir $PKG/usr/share/man/man7 $PKG/usr/share/man/man8
}
