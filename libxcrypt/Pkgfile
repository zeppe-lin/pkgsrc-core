# Description: Modern library for one-way hashing of passwords
# URL:         https://github.com/besser82/libxcrypt

name=libxcrypt
version=4.5.2 # XXX keep in sync with libxcrypt-32
release=1
source=https://github.com/besser82/$name/releases/download/v$version/$name-$version.tar.xz

build() {
	mkdir build; cd build

	../$name-$version/configure \
		--prefix=/usr \
		--disable-failure-tokens \
		--disable-silent-rules \
		--disable-valgrind \
		--enable-hashes=strong,glibc \
		--enable-obsolete-api=no \
		--enable-shared \
		--enable-static \
		--with-pkgconfigdir=/usr/lib/pkgconfig \

	make V=1
	make DESTDIR=$PKG install

	# Relocate libcrypt to /lib
	mkdir -p $PKG/lib
	mv $PKG/usr/lib/libcrypt.so.* $PKG/lib
	ln -fns ../../lib/$(readlink $PKG/usr/lib/libcrypt.so) \
		$PKG/usr/lib/libcrypt.so

	# Remove junk
	rm $PKG/usr/lib/libcrypt.la
}
