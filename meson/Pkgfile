# Description: Meson build system
# URL:         https://mesonbuild.com/
# Depends on:  py3-setuptools

name=meson
version=1.10.1
release=1
source=https://github.com/mesonbuild/meson/releases/download/$version/meson-$version.tar.gz

build() {
	cd meson-$version

	gpep517 build-wheel --wheel-dir .dist --output-fd 3 3>&1 >&2
	/usr/bin/python3 -m installer -d $PKG .dist/*.whl

	/usr/bin/python3     -m compileall $PKG
	/usr/bin/python3 -O  -m compileall $PKG
	/usr/bin/python3 -OO -m compileall $PKG

	# Fix man permission
	chmod 0644 $PKG/usr/share/man/man1/meson.1

	# Vim syntax highlight
	mkdir -p $PKG/usr/share/vim/vimfiles
	cp -rt $PKG/usr/share/vim/vimfiles data/syntax-highlighting/vim/*/

	# bash completion
	install -m 0644 -Dt $PKG/usr/share/bash-completion/completions \
		data/shell-completions/bash/*

	# zsh completion
	#install -m 0644 -Dt $PKG/usr/share/zsh/site-functions \
	#	data/shell-completions/zsh/*

	# Remove junk
	rm -r $PKG/usr/share/polkit-1
}
