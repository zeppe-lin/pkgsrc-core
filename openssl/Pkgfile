# Description: SSL/TLS cryptography toolkit
# URL:         https://www.openssl.org/

name=openssl
version=3.6.1
release=1
source=https://www.openssl.org/source/$name-$version.tar.gz

build() {
	mkdir build; cd build

	../$name-$version/config \
		--prefix=/usr \
		--libdir=lib \
		--openssldir=/etc/ssl \
		disable-tests \
		enable-camellia \
		enable-ec_nistp_64_gcc_128 \
		enable-rfc3779 \
		enable-seed \
		no-ec2m \
		no-mdc2 \
		no-sm2 \
		no-sm4 \
		shared \
		threads \
		zlib \

	# Honor system CFLAGS
	sed -i "s:-O3:$CFLAGS:" Makefile

	make V=1 depend
	make V=1
	make V=1 MANSUFFIX=ssl DESTDIR=$PKG \
		install_sw install_ssldirs install_man_docs

	# Prune FIPS-related artefacts
	find $PKG -name "*fips*" -exec rm -rf {} +
}
