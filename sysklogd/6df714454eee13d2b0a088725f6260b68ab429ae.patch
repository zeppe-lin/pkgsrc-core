From 6df714454eee13d2b0a088725f6260b68ab429ae Mon Sep 17 00:00:00 2001
From: Joachim Wiberg <troglobit@gmail.com>
Date: Sun, 21 Jul 2024 19:15:48 +0200
Subject: [PATCH] Fix #87: segfault on shutdown

Regression introduced in in 36295e3, for issue #82.

Signed-off-by: Joachim Wiberg <troglobit@gmail.com>
---
 src/syslogd.c | 10 +++++-----
 1 file changed, 5 insertions(+), 5 deletions(-)

diff --git a/src/syslogd.c b/src/syslogd.c
index f7a4ee5..2d357f1 100644
--- a/src/syslogd.c
+++ b/src/syslogd.c
@@ -2580,11 +2580,6 @@ void die(int signo)
 	 */
 	timer_exit();
 
-	/*
-	 * Close all open log files.
-	 */
-	close_open_log_files();
-
 	/*
 	 * Close all UNIX and inet sockets
 	 */
@@ -2594,6 +2589,11 @@ void die(int signo)
 		free(pe);
 	}
 
+	/*
+	 * Close all open log files.
+	 */
+	close_open_log_files();
+
 	kern_console_on();
 
 	exit(0);
