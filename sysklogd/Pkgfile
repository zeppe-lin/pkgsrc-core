# Description: Kernel and system logging daemons
# URL:         https://github.com/troglobit/sysklogd

name=sysklogd
version=2.7.2
release=3
source="https://github.com/troglobit/$name/releases/download/v$version/$name-$version.tar.gz
	syslogd.8.patch
	syslog.conf
	logrotate.syslog
	rc.sysklogd"

build() {
	for f in $SRC/*.patch; do
		patch -d $name-$version -Np1 -i $f
	done
	
	mkdir build; cd build

	# --without-logger: logger(1) is provided by util-linux or sbase
	../$name-$version/configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--localstatedir=/var \
		--runstatedir=/run \
		--disable-static \
		--without-logger \

	make V=1
	make DESTDIR=$PKG install

	install -m 0644 -D $SRC/logrotate.syslog $PKG/etc/logrotate.d/syslog
	install -m 0755 -D $SRC/rc.sysklogd $PKG/etc/rc.d/sysklogd
	install -m 0644 -D $SRC/syslog.conf $PKG/etc/syslog.conf

	mkdir -p $PKG/var/log $PKG/etc/syslog.d

	for f in auth cron debug kernel mail messages; do
		touch      $PKG/var/log/$f
		chmod 0640 $PKG/var/log/$f
	done

	# Remove junk
	rm -r $PKG/usr/share/doc
	rm $PKG/usr/lib/*.la
}
