# Description: Network utility for downloading content from the Web
# URL:         https://www.gnu.org/software/wget/
# Depends on:  libpcre2 libunistring openssl zlib

# Maintainer notes on dependencies:
#   --disable-iri:     disable IDN/IRIs support, requires libidn
#   --without-cares:   disable C-Ares DNS lookup, requires c-ares
#   --without-libpsl:  disable libpsl cookie checking, requires libpsl
#   --without-libuuid: skip UUID generation for WARC, requires util-linux
#
# These optional dependencies (libidn, c-ares, libpsl) are not provided in
# pkgsrc-core, so support is disabled.

name=wget
version=1.25.0
release=1
source="https://ftp.gnu.org/gnu/wget/wget-$version.tar.lz
	wgetrc"

build() {
	export PYTHON=/usr/bin/python3

	mkdir build; cd build

	../wget-$version/configure \
		--prefix=/usr \
		--sysconfdir=/etc \
		--disable-debug \
		--disable-iri \
		--disable-pcre \
		--disable-nls \
		--with-ssl=openssl \
		--without-cares \
		--without-libpsl \
		--without-libuuid \

	make V=1
	make DESTDIR=$PKG install 

	# Fix config file reference in manual page
	sed -i 's|/usr/local/etc/wgetrc|/etc/wgetrc|g' \
		$PKG/usr/share/man/man1/wget.1

	# Install our config file
	install -m 0644 -Dt $PKG/etc $SRC/wgetrc

	# Remove junk
	rm -r $PKG/usr/share/info
}
